## ----------------------------------------------------------------------- ##
 # CMakeLists.txt
 # This file is part of Lincity-NG.
 #
 # Copyright (C) 2025      David Bears <dbear4q@gmail.com>
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License along
 # with this program; if not, write to the Free Software Foundation, Inc.,
 # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
## ----------------------------------------------------------------------- ##

# exclude files from source packages that are ignored by git
if(CPACK_TOPLEVEL_TAG STREQUAL CPACK_SOURCE_TOPLEVEL_TAG AND "@GIT_FOUND@")
  execute_process(
    COMMAND "@GIT_EXECUTABLE@" ls-files
      --ignored --other --exclude-standard --directory
    WORKING_DIRECTORY "@CMAKE_SOURCE_DIR@"
    RESULT_VARIABLE status
    OUTPUT_VARIABLE GIT_IGNORED_FILES
    OUTPUT_STRIP_TRAILING_WHITESPACE
  )
  if(NOT status EQUAL 0)
    message(ERROR "Failed to query git for file ignore list.")
  endif()
  string(REPLACE "\n" ";" GIT_IGNORED_FILES "${GIT_IGNORED_FILES}")
  list(APPEND GIT_IGNORED_FILES ".git/") # .git/ is implicitly untracked
  foreach(IGN_FILE ${GIT_IGNORED_FILES})
    string(REGEX REPLACE "." "\\\\\\0"
      IGN_FILE_QUOTED "@CMAKE_SOURCE_DIR@/${IGN_FILE}")
    list(APPEND CPACK_IGNORE_FILES "^${IGN_FILE_QUOTED}")
  endforeach()
endif()
